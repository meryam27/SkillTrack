# SkillTrack - Schéma MongoDB Complet

## Vue d'ensemble

MongoDB offre une flexibilité exceptionnelle pour SkillTrack grâce aux documents imbriqués et aux tableaux dynamiques. Cette architecture permet une évolution rapide et une scalabilité horizontale.

---

## 1. Collections Principales & Structures

### 1.1 Collection: `users`

**Responsabilité:** Authentification et données de base utilisateur.

```json
{
  "_id": ObjectId,
  "email": String (unique, indexed),
  "password_hash": String,
  "username": String (unique),
  "firstName": String,
  "lastName": String,
  "phone": String,
  "avatar_url": String,
  "role": String (enum: ["student", "mentor", "admin"]),
  "is_active": Boolean,
  "email_verified": Boolean,
  "createdAt": Date,
  "updatedAt": Date,
  "lastLoginAt": Date,
  "profile_completed": Boolean,
  "onboarding_completed": Boolean
}
```

**Indexes:**

```javascript
db.users.createIndex({ email: 1 });
db.users.createIndex({ username: 1 });
db.users.createIndex({ createdAt: -1 });
```

---

### 1.2 Collection: `profiles`

**Responsabilité:** Profil détaillé et preferences utilisateur.

```json
{
  "_id": ObjectId,
  "user_id": ObjectId (ref to users),
  "bio": String,
  "university": String,
  "degree": String,
  "field_of_study": String,
  "graduation_year": Number,
  "career_goal": String,
  "target_job_title": String,
  "target_industries": [String],
  "location": String,
  "timezone": String,
  "language_preference": String (enum: ["fr", "en"]),
  "learning_style": String (enum: ["visual", "auditory", "kinesthetic", "reading-writing"]),
  "pace_preference": String (enum: ["slow", "moderate", "fast"]),
  "motivation_style": String (enum: ["intrinsic", "extrinsic"]),
  "notification_settings": {
    "email_notifications": Boolean,
    "smart_nudges": Boolean,
    "weekly_digest": Boolean,
    "badge_alerts": Boolean
  },
  "accessibility_preferences": {
    "high_contrast": Boolean,
    "font_size": String,
    "screen_reader": Boolean
  },
  "createdAt": Date,
  "updatedAt": Date
}
```

**Indexes:**

```javascript
db.profiles.createIndex({ user_id: 1 });
db.profiles.createIndex({ target_job_title: 1 });
db.profiles.createIndex({ updatedAt: -1 });
```

---

### 1.3 Collection: `skills`

**Responsabilité:** Référentiel global de compétences (base d'apprentissage).

```json
{
  "_id": ObjectId,
  "name": String (unique),
  "category": String (enum: ["technical", "soft_skill", "language", "tool", "framework"]),
  "description": String,
  "level_ranges": [
    {
      "level": Number (1-5),
      "name": String (e.g., "Beginner", "Intermediate", "Advanced"),
      "description": String,
      "estimated_hours": Number
    }
  ],
  "prerequisites": [ObjectId],
  "related_skills": [ObjectId],
  "market_demand": {
    "score": Number (0-100),
    "trending": Boolean,
    "job_postings_count": Number,
    "last_updated": Date
  },
  "learning_resources": [
    {
      "title": String,
      "url": String,
      "type": String (enum: ["video", "article", "course", "documentation", "book"]),
      "duration_minutes": Number,
      "difficulty": String (enum: ["beginner", "intermediate", "advanced"]),
      "platform": String,
      "rating": Number (0-5)
    }
  ],
  "tags": [String],
  "created_at": Date,
  "updated_at": Date
}
```

**Indexes:**

```javascript
db.skills.createIndex({ name: 1 });
db.skills.createIndex({ category: 1 });
db.skills.createIndex({ "market_demand.trending": 1 });
```

---

### 1.4 Collection: `user_skills`

**Responsabilité:** Compétences actuelles et progression de chaque utilisateur.

```json
{
  "_id": ObjectId,
  "user_id": ObjectId (ref to users),
  "skill_id": ObjectId (ref to skills),
  "current_level": Number (1-5),
  "proficiency_percentage": Number (0-100),
  "experience_years": Number,
  "last_used_date": Date,
  "validation_status": String (enum: ["self_assessed", "peer_reviewed", "project_validated", "certification_verified"]),
  "proof_of_skill": [
    {
      "type": String (enum: ["certificate", "project", "test_score", "portfolio_item"]),
      "title": String,
      "url": String,
      "verified_at": Date
    }
  ],
  "confidence_score": Number (0-100),
  "is_primary_skill": Boolean,
  "skill_relevance_to_goal": Number (0-100),
  "acquired_date": Date,
  "createdAt": Date,
  "updatedAt": Date
}
```

**Indexes:**

```javascript
db.user_skills.createIndex({ user_id: 1, skill_id: 1 }, { unique: true });
db.user_skills.createIndex({ user_id: 1, current_level: -1 });
db.user_skills.createIndex({ validation_status: 1 });
```

---

### 1.5 Collection: `academic_paths`

**Responsabilité:** Parcours académiques officiels de l'étudiant.

```json
{
  "_id": ObjectId,
  "user_id": ObjectId (ref to users),
  "program_name": String,
  "institution": String,
  "start_date": Date,
  "expected_graduation_date": Date,
  "current_year": Number,
  "total_years": Number,
  "modules": [
    {
      "module_id": ObjectId,
      "name": String,
      "credits": Number,
      "semester": Number,
      "status": String (enum: ["planned", "in_progress", "completed", "failed"]),
      "grade": String (A+, A, B+, B, etc.),
      "grade_numeric": Number (0-100),
      "completion_date": Date,
      "skills_taught": [ObjectId],
      "attendance_percentage": Number
    }
  ],
  "total_credits_earned": Number,
  "cumulative_gpa": Number,
  "progress_percentage": Number,
  "createdAt": Date,
  "updatedAt": Date
}
```

**Indexes:**

```javascript
db.academic_paths.createIndex({ user_id: 1 });
db.academic_paths.createIndex({ institution: 1 });
db.academic_paths.createIndex({ expected_graduation_date: 1 });
```

---

### 1.6 Collection: `learning_objectives`

**Responsabilité:** Objectifs d'apprentissage personnalisés et roadmap de l'étudiant.

```json
{
  "_id": ObjectId,
  "user_id": ObjectId (ref to users),
  "title": String,
  "description": String,
  "objective_type": String (enum: ["skill_improvement", "career_goal", "academic", "personal"]),
  "target_skill_id": ObjectId,
  "status": String (enum: ["active", "completed", "abandoned", "paused"]),
  "priority": String (enum: ["low", "medium", "high", "critical"]),
  "start_date": Date,
  "target_completion_date": Date,
  "actual_completion_date": Date,
  "progress_percentage": Number,
  "milestones": [
    {
      "milestone_id": ObjectId,
      "title": String,
      "description": String,
      "target_date": Date,
      "completion_date": Date,
      "status": String (enum: ["pending", "in_progress", "completed"]),
      "weight_percentage": Number
    }
  ],
  "learning_resources": [ObjectId],
  "estimated_hours": Number,
  "actual_hours_spent": Number,
  "breakdown_by_category": {
    "videos": Number,
    "articles": Number,
    "projects": Number,
    "quizzes": Number
  },
  "createdAt": Date,
  "updatedAt": Date
}
```

**Indexes:**

```javascript
db.learning_objectives.createIndex({ user_id: 1, status: 1 });
db.learning_objectives.createIndex({ target_completion_date: 1 });
db.learning_objectives.createIndex({ priority: -1 });
```

---

### 1.7 Collection: `recommendations`

**Responsabilité:** Recommandations d'apprentissage générées par l'IA.

```json
{
  "_id": ObjectId,
  "user_id": ObjectId (ref to users),
  "recommendation_type": String (enum: ["skill_gap", "market_trend", "career_path", "project_based", "peer_learning"]),
  "source": String (enum: ["ai_engine", "market_analysis", "academic_advisor", "peer_suggestion"]),
  "skill_id": ObjectId,
  "learning_resource_id": ObjectId,
  "title": String,
  "description": String,
  "reason": String (explication de pourquoi cette recommandation),
  "relevance_score": Number (0-100),
  "priority": String (enum: ["low", "medium", "high"]),
  "estimated_duration_hours": Number,
  "market_alignment": {
    "job_demand": Number,
    "salary_impact": Number,
    "skill_gap_severity": Number
  },
  "status": String (enum: ["new", "viewed", "started", "completed", "dismissed"]),
  "ai_reasoning": String,
  "created_at": Date,
  "viewed_at": Date,
  "started_at": Date,
  "completed_at": Date,
  "dismissed_at": Date
}
```

**Indexes:**

```javascript
db.recommendations.createIndex({ user_id: 1, status: 1 });
db.recommendations.createIndex({ relevance_score: -1 });
db.recommendations.createIndex({ created_at: -1 });
```

---

### 1.8 Collection: `skill_progress_tracking`

**Responsabilité:** Suivi granulaire de la progression en compétences.

```json
{
  "_id": ObjectId,
  "user_id": ObjectId (ref to users),
  "skill_id": ObjectId (ref to skills),
  "session_date": Date,
  "activity_type": String (enum: ["course_completion", "project_submission", "quiz_passed", "certification", "practice_session"]),
  "xp_earned": Number,
  "time_spent_minutes": Number,
  "assessment_score": Number (0-100),
  "material_completed": String,
  "notes": String,
  "level_before": Number,
  "level_after": Number,
  "level_up": Boolean,
  "metadata": {
    "resource_url": String,
    "resource_title": String,
    "difficulty_level": String
  },
  "createdAt": Date
}
```

**Indexes:**

```javascript
db.skill_progress_tracking.createIndex({
  user_id: 1,
  skill_id: 1,
  session_date: -1,
});
db.skill_progress_tracking.createIndex({ session_date: -1 });
```

---

### 1.9 Collection: `gamification_profiles`

**Responsabilité:** Gamification et engagement (XP, niveaux, streaks).

```json
{
  "_id": ObjectId,
  "user_id": ObjectId (ref to users),
  "total_xp": Number,
  "level": Number,
  "xp_to_next_level": Number,
  "current_xp_progress": Number,
  "current_streak_days": Number,
  "longest_streak_days": Number,
  "total_days_active": Number,
  "last_activity_date": Date,
  "badges": [
    {
      "badge_id": ObjectId,
      "name": String,
      "description": String,
      "icon_url": String,
      "earned_at": Date,
      "rarity": String (enum: ["common", "rare", "epic", "legendary"])
    }
  ],
  "achievements": [
    {
      "achievement_id": ObjectId,
      "title": String,
      "description": String,
      "progress": Number,
      "target": Number,
      "completed": Boolean,
      "completed_at": Date
    }
  ],
  "leaderboard_position": Number,
  "total_points_this_month": Number,
  "total_points_this_year": Number,
  "createdAt": Date,
  "updatedAt": Date
}
```

**Indexes:**

```javascript
db.gamification_profiles.createIndex({ user_id: 1 });
db.gamification_profiles.createIndex({ total_xp: -1 });
db.gamification_profiles.createIndex({ level: -1 });
db.gamification_profiles.createIndex({ last_activity_date: -1 });
```

---

### 1.10 Collection: `badges_achievements`

**Responsabilité:** Définitions des badges et achievements globales.

```json
{
  "_id": ObjectId,
  "name": String,
  "description": String,
  "category": String (enum: ["skill", "streak", "milestone", "social", "special"]),
  "icon_url": String,
  "rarity": String (enum: ["common", "rare", "epic", "legendary"]),
  "unlock_condition": {
    "type": String (enum: ["skill_level", "streak", "xp_threshold", "project_completion", "custom"]),
    "criteria": Object,
    "description": String
  },
  "xp_reward": Number,
  "created_at": Date
}
```

**Indexes:**

```javascript
db.badges_achievements.createIndex({ category: 1 });
```

---

### 1.11 Collection: `portfolio_items`

**Responsabilité:** Projets et réalisations du portfolio étudiant.

```json
{
  "_id": ObjectId,
  "user_id": ObjectId (ref to users),
  "title": String,
  "description": String,
  "content": String (HTML/Markdown),
  "project_type": String (enum: ["academic", "personal", "professional", "open_source", "hackathon"]),
  "technologies_used": [ObjectId],
  "skills_demonstrated": [ObjectId],
  "project_url": String,
  "github_url": String,
  "images": [
    {
      "url": String,
      "caption": String,
      "order": Number
    }
  ],
  "start_date": Date,
  "completion_date": Date,
  "duration_weeks": Number,
  "team_members": [
    {
      "name": String,
      "role": String,
      "url": String
    }
  ],
  "impact": {
    "description": String,
    "metrics": String
  },
  "visibility": String (enum: ["private", "public", "portfolio_only"]),
  "featured": Boolean,
  "views_count": Number,
  "likes_count": Number,
  "createdAt": Date,
  "updatedAt": Date
}
```

**Indexes:**

```javascript
db.portfolio_items.createIndex({ user_id: 1 });
db.portfolio_items.createIndex({ visibility: 1, featured: -1 });
db.portfolio_items.createIndex({ createdAt: -1 });
```

---

### 1.12 Collection: `notifications`

**Responsabilité:** Notifications et alertes système pour l'utilisateur.

```json
{
  "_id": ObjectId,
  "user_id": ObjectId (ref to users),
  "type": String (enum: ["smart_nudge", "badge_earned", "milestone_reached", "recommendation", "deadline", "social", "system"]),
  "title": String,
  "message": String,
  "action_url": String,
  "is_read": Boolean,
  "read_at": Date,
  "priority": String (enum: ["low", "normal", "high", "critical"]),
  "metadata": {
    "related_skill_id": ObjectId,
    "related_objective_id": ObjectId,
    "action_button_text": String
  },
  "created_at": Date,
  "expires_at": Date
}
```

**Indexes:**

```javascript
db.notifications.createIndex({ user_id: 1, is_read: 1 });
db.notifications.createIndex({ created_at: -1 });
db.notifications.createIndex({ expires_at: 1 }, { expireAfterSeconds: 0 }); // TTL
```

---

### 1.13 Collection: `feedback_logs`

**Responsabilité:** Feedback intelligent généré par l'IA pour chaque utilisateur.

```json
{
  "_id": ObjectId,
  "user_id": ObjectId (ref to users),
  "feedback_type": String (enum: ["progress_report", "skill_gap_analysis", "learning_insights", "career_advice", "motivation_boost"]),
  "content": String,
  "is_ai_generated": Boolean,
  "ai_model": String (e.g., "gpt-4", "claude-3"),
  "triggered_by": String (enum: ["scheduled", "milestone", "request", "anomaly"]),
  "skill_context": [ObjectId],
  "sentiment": String (enum: ["positive", "neutral", "constructive"]),
  "actionable_items": [String],
  "engagement_score": Number (0-100),
  "user_feedback": {
    "helpful": Boolean,
    "comment": String,
    "rating": Number (1-5)
  },
  "created_at": Date,
  "viewed_at": Date
}
```

**Indexes:**

```javascript
db.feedback_logs.createIndex({ user_id: 1, created_at: -1 });
db.feedback_logs.createIndex({ feedback_type: 1 });
```

---

### 1.14 Collection: `learning_sessions`

**Responsabilité:** Historique détaillé de chaque session d'apprentissage.

```json
{
  "_id": ObjectId,
  "user_id": ObjectId (ref to users),
  "skill_id": ObjectId,
  "resource_id": ObjectId,
  "session_start": Date,
  "session_end": Date,
  "duration_minutes": Number,
  "activities": [
    {
      "activity_type": String (enum: ["video_watch", "article_read", "quiz", "exercise", "project_work"]),
      "duration_minutes": Number,
      "completion_percentage": Number,
      "score": Number,
      "timestamp": Date
    }
  ],
  "total_focus_time": Number,
  "distractions_count": Number,
  "completed": Boolean,
  "xp_earned": Number,
  "quality_score": Number,
  "notes": String,
  "created_at": Date
}
```

**Indexes:**

```javascript
db.learning_sessions.createIndex({
  user_id: 1,
  skill_id: 1,
  session_start: -1,
});
db.learning_sessions.createIndex({ session_start: -1 });
```

---

### 1.15 Collection: `ai_conversation_logs`

**Responsabilité:** Historique des conversations avec le Career Coach IA.

```json
{
  "_id": ObjectId,
  "user_id": ObjectId (ref to users),
  "conversation_id": String,
  "messages": [
    {
      "role": String (enum: ["user", "assistant"]),
      "content": String,
      "timestamp": Date,
      "tokens_used": Number
    }
  ],
  "conversation_topic": String (enum: ["career_advice", "skill_development", "roadmap", "motivation", "technical_help"]),
  "context": {
    "user_skills": [ObjectId],
    "user_objectives": [ObjectId],
    "market_data": Object
  },
  "summary": String,
  "helpful_rating": Number (1-5),
  "created_at": Date,
  "closed_at": Date
}
```

**Indexes:**

```javascript
db.ai_conversation_logs.createIndex({ user_id: 1, created_at: -1 });
db.ai_conversation_logs.createIndex({ conversation_id: 1 });
```

---

## 2. Stratégies de Modélisation & Considérations

### Dénormalisation Stratégique

Pour éviter N+1 queries, certains champs sont dénormalisés:

- `user_skills.skill_name` (copie de `skills.name`)
- `recommendations.skill_name` (référence rapide)

### Tableaux Imbriqués vs Collections Séparées

- **Imbriqués:** `learning_objectives.milestones`, `profiles.notification_settings`, `gamification_profiles.badges`
- **Séparées:** `skills`, `user_skills`, `learning_sessions` (pour des volumes élevés)

### Indexation pour Performance

- Tous les `_id` générés par Mongo
- Indexes composites pour recherches fréquentes
- TTL indexes pour les données temporaires (notifications expirées)

---

## 3. Relations Clés

```
users
  ├── profiles (1:1)
  ├── user_skills (1:N) → skills (N:N)
  ├── learning_objectives (1:N) → skills (1:N)
  ├── academic_paths (1:N)
  ├── recommendations (1:N)
  ├── portfolio_items (1:N)
  ├── gamification_profiles (1:1)
  ├── notifications (1:N)
  ├── feedback_logs (1:N)
  ├── learning_sessions (1:N)
  └── ai_conversation_logs (1:N)

skills
  ├── prerequisites (N:N → skills)
  ├── related_skills (N:N → skills)
  └── user_skills (N:N with users)
```

---

## 4. Avantages de MongoDB pour SkillTrack

✅ **Flexibilité:** Ajouter des champs sans migration (ex: nouveaux types de badges)
✅ **Documents Imbriqués:** Structures hiérarchiques (objectifs → jalons → activités)
✅ **Scalabilité:** Sharding horizontal par `user_id`
✅ **Requêtes Complexes:** Aggregation pipeline pour analytics et insights IA
✅ **Temps Réel:** Support natif pour les mises à jour en temps réel
✅ **Flexibilité du Profil Utilisateur:** Chaque étudiant peut avoir une structure légèrement différente

```

---

## 5. Estimation de Volume & Storage

| Collection | Avg Doc Size | Grow avec | Annual Storage (1M users) |
|---|---|---|---|
| users | 2KB | users | 2GB |
| profiles | 3KB | users | 3GB |
| skills | 10KB | content teams | 500MB (static) |
| user_skills | 1.5KB | user × skills | 1.5TB |
| learning_objectives | 4KB | objectives/user | 4TB |
| recommendations | 2KB | recommendations/user | 2TB |
| skill_progress_tracking | 500B | sessions × 5/day | 750GB |
| **TOTAL** | | | **~11.7TB** (optimizable avec archivage) |

---

## Configuration Recommandée MongoDB Atlas

```

Tier: M30 (8GB RAM) → M50 (16GB RAM) avec croissance
Region: Multiregion (Europe + USA) pour latence basse
Backup: Continuous backups + point-in-time restore
Monitoring: Atlas Monitoring + alertes performance
Replication: 3-node replica set (haute disponibilité)
